name: "EfficientNetv2 S Imagenette single pipeline benchmark"
pipelines:
  - name: EfficientNetv2 S Imagenette
    inputs: [0]
    outputs: [3]
    loadgen:
      type: offline
      max_queries: 200
      timeout: 30
      config:
        rate: 10 # average #requests/sec
    stages:
      - name: Imagenette dataset
        id: 0
        outputs: [1]
        type: dataset
        module_name: torchvision_dataset
        config:
          dataset_name: Imagenette # must be title-case
          split: [val]
          batch_size: 1
      - name: Load Imagenette samples from TorchVision Dataset
        id: 1
        inputs: [0]
        outputs: [2]
        type: data_loading
        module_name: torch_from_dataset
        ingest_dataset: True
        config:
          batch_size: 1
          num_workers: 0 # if 0 no prefetching else prefetches 2*num_workers samples
      - name: Preprocess Imagenette data coming from DataLoader
        id: 2
        inputs: [1]
        outputs: [3]
        type: preprocessing
        module_name: torchvision_preprocess_from_weights
        config:
          weights: EfficientNet_V2_S_Weights.IMAGENET1K_V1
      - name: EfficientNet inference
        id: 3
        inputs: [2]
        type: inference
        module_name: torchvision_classification
        config:
          model: efficientnet_v2_s
          model_checkpoint_path: "efficientnet_example/efficientnet_v2_imagenette.pth"
          replace_classifier: True
          num_classes: 10
